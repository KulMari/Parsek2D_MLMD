#!/bin/sh

#PBS -l walltime=24:00:00
#!PBS -l nodes=128
#!PBS -l nodes=32:ppn=4:ib2
#PBS -l nodes=32:ppn=4

#PBS -N SelfRest1836
#PBS -j oe -k eo

echo Start: host `hostname`, date `date`
NPROCS=`wc -l < $PBS_NODEFILE`
echo Number of nodes is $NPROCS
echo PBS id is $PBS_JOBID
echo Assigned nodes: `cat $PBS_NODEFILE`

echo Creating directories
for node in `cat $PBS_NODEFILE`
do
echo Doing node $node
ssh $node mkdir /scratch/gianni
ssh $node cp -u /l/users/u0052182/prit/* /scratch/gianni
done
echo Done.
		

cd ~/Parsek2D

mpirun -v -machinefile $PBS_NODEFILE -np $NPROCS ./ParsekEM restart inputfile.gem1836

echo Moving from  directories
for node in `cat $PBS_NODEFILE`
do
echo Doing node $node
ssh $node mv -u /scratch/gianni/* /l/users/u0052182/prit
done
echo Done.
